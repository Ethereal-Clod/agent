# 🏡 AI 用电助手 (家庭版) - 项目功能设计书

**版本：2.0**

## 1. 项目概述

### 1.1. 项目背景与目标

本项目采用 **模块化单体架构**，旨在模拟一个具备 AI 决策能力的家庭智能电网终端。通过模拟家庭用电场景，展示 AI Agent 如何辅助用户进行节能决策和设备控制。

- **前端**: Vue 3 (Vite + Pinia + Element Plus/Ant Design)
- **后端**: Python FastAPI (异步架构)
- **AI 引擎**: LangGraph (集成于 FastAPI 中)

### 1.2. 核心价值

- **全流程账户管理**: 完整的注册、登录、获取用户信息和注销体验，确保数据隔离和安全。
- **多维度数据洞察**: 通过独立的 API 获取实时趋势、AI 归因分析和设备状态，实现前端组件的独立、高效渲染。
- **AI 介入式控制**: 模拟“智能总闸”，在用户操作设备时，AI 实时介入分析并提供决策依据，实现真正的智能交互。
- **自然语言顾问**: 内置聊天机器人，让用户可以通过对话获取数据、分析和节能建议。

## 2. 功能模块详解

### 2.1. 模块一：身份认证系统 (Authentication)

此模块负责用户的准入、状态管理和安全退出。

- **功能 1: 用户注册**
  - **流程**: 用户提供用户名、密码和家庭住址，系统创建新账户。
  - **价值**: 允许新用户加入系统，地址信息将用于 AI 判断天气区域，提供更精准的建议。

- **功能 2: 用户登录**
  - **流程**: 用户通过用户名和密码获取一个有时效性的访问令牌 (JWT Token)。
  - **价值**: 验证用户身份，后续所有操作都需要携带此令牌，保证系统安全。

- **功能 3: 获取当前用户信息**
  - **流程**: 前端应用启动或刷新页面时，使用已存储的 Token 调用此接口，获取当前用户的详细信息。
  - **价值**: 实现持久化登录状态，提升用户体验。

- **功能 4: 用户登出**
  - **流程**: 前端清除本地存储的 Token，并通知后端（可选），安全退出登录。

### 2.2. 模块二：智能监控仪表盘 (Smart Dashboard)

这是核心主页，采用组件化加载方式，不同图表调用不同的 API，避免单次请求过大，提升页面加载速度。

- **组件 1: 关键指标卡 (KPI Cards)**
  - **展示**: 直观显示“当前总功率”、“今日预估电费”、“本月累计用电”和“开启的电器数量”。
  - **价值**: 让用户对家庭用电现状一目了然。

- **组件 2: 实时用电趋势 (Real-time Trend)**
  - **展示**: 折线图，清晰展示过去24小时、一周或一月的用电波动情况。
  - **价值**: 帮助用户发现用电高峰时段和规律。

- **组件 3: AI 归因分析 (Impact Factors)**
  - **展示**: 雷达图或饼图，由 AI 分析生成，展示各类因素（如天气、大功率电器）对电费的影响权重。
  - **价值**: 将复杂的用电数据转化为简单易懂的洞察，并提供 AI 节能建议。

- **组件 4: 电器状态列表 (Appliance Grid)**
  - **展示**: 以卡片网格形式，实时显示家中每个电器的名称、图标、开关状态和实时功率。
  - **价值**: 提供家庭电器的集中视图和控制入口。

### 2.3. 模块三：智能设备管理 (Smart Control)

模拟用户通过 APP 远程控制家中电器，AI 作为“管家”进行审核与建议。

- **核心交互**: 用户在 APP 上点击电器的开关。
- **AI 介入**: 后端在执行开关操作前，先将请求转发给 AI Agent。Agent 会结合当前环境（如电价、温度、时间）进行分析。
- **智能反馈**: 操作成功后，不仅返回结果，还会附带一条来自 AI 的、有价值的反馈信息（如节能建议、成本预估）。

### 2.4. 模块四：AI 用电顾问 (Chat Assistant)

一个独立的聊天窗口，提供自然语言交互的入口。

- **功能**:
  - **自由问答**: 解答用户关于节能、电费的各种问题。
  - **数据查询**: 支持用自然语言查询历史数据（“我上个月用了多少电？”）。
  - **指令执行**: 通过快捷指令或对话，生成用电报告等。
- **技术**: 后端接口支持流式输出，实现类似 ChatGPT 的逐字显示效果，提升交互体验。

---

## 3. API 接口清单 (V2.0)

**基础路径 (Base URL):** `http://localhost:8000`
**认证方式:** 所有非 Auth 接口均需在 Request Header 中携带 `Authorization: Bearer <token>`

### 3.1. 🔐 身份认证 (Authentication)

| Method | URL | 描述 |
| :--- | :--- | :--- |
| `POST` | `/api/auth/register` | 用户注册 |
| `POST` | `/api/auth/token` | 用户登录 (获取 Token) |
| `GET` | `/api/auth/me` | 获取当前用户信息 |
| `POST` | `/api/auth/logout` | 用户登出 |

### 3.2. 📊 仪表盘数据 (Dashboard Data)

| Method | URL | 描述 |
| :--- | :--- | :--- |
| `GET` | `/api/data/summary` | 获取今日概览 (KPI Cards) |
| `GET` | `/api/data/consumption/trend` | 获取用电趋势 (Line Chart) |
| `GET` | `/api/data/consumption/factors`| 获取用电影响因素 (AI Analysis) |

### 3.3. 💡 智能设备管理 (Smart Control)

| Method | URL | 描述 |
| :--- | :--- | :--- |
| `GET` | `/api/appliances` | 获取电器列表与状态 |
| `POST` | `/api/appliances/{id}/control`| 控制电器 (AI 介入) |

### 3.4. 💬 AI 用电顾问 (Chat)

| Method | URL | 描述 |
| :--- | :--- | :--- |
| `POST` | `/api/chat/completions` | 发送对话消息 |

---

## 4. 数据字典与枚举

### 4.1 电器类型 (Appliance Type)

- `ac`: 空调
- `fridge`: 冰箱
- `light`: 照明
- `tv`: 电视
- `heater`: 热水器/暖气
- `other`: 其他

### 4.2 API 错误码

- `400 Bad Request`: 参数错误
- `401 Unauthorized`: Token 无效或过期
- `403 Forbidden`: 权限不足
- `404 Not Found`: 资源不存在
- `500 Internal Server Error`: 服务器内部错误 (如 Agent 服务超时)